# Nervos

- Cell 模型
- 密码学原语
- NC-MAX
- 经济模型
- NervosDAO
- force bridge
- gliaswap

## 综述

首先我们要明确 CKB 在设计之初试图去解决的问题：

1. [状态爆炸](https://talk.nervos.org/t/topic/1515) 引起的公地悲剧及去中心化的丧失
2. [计算和验证耦合在了一起](https://talk.nervos.org/t/layer-1/1486) 使得无论是计算还是验证都失去了灵活性，难以扩展；
3. [交易与价值存储这两个目标的内在矛盾](https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0015-ckb-cryptoeconomics/0015-ckb-cryptoeconomics.md#3-preservational-and-transactional-smart-contract-platforms)，Layer 2和跨链的出现将放大这种矛盾，并对Layer 1的经济产生非常负面的影响；

layer1 层面应该专注于状态共识（存储），layer2 层面应该专注于状态生成（计算），我们不该用牺牲共识范围来换取性能，全球共识的代价必然是性能低下。分层网络必然是未来的方向，所以应该设计一个原生支持分层网络的系统。

## CKB 的亮点

1. 计算和验证的天然解耦，使得原生支持 layer1 以及 layer2 
2. Cell 中的 capacity 字段，实现了状态租赁，解决了状态爆炸的问题

## Cell 模型

Cell 是 CKB 中最基本的状态单元，用户可以在其中包含任意的状态。一个 Cell 由以下几个字段组成:

- `容量(capacity)`：Cell 的大小限制。一个 Cell 的大小是指包含所有字段的总字节数。
- `数据(data)`：状态数据存储在 Cell 中。它可以是空的，Cell 的总字节数必须总是小于或等于 Cell 的容量。
- `类型脚本(type)`：验证状态的脚本。在**验证交易输出**的时候执行，确保用户生成的新状态符合类型约束，正确生成了新的 Cells 。
- `锁定脚本(lock)`: 代表 Cell 的所有权的脚本。只有 Cell 的所有者才能转移 Cell。在**验证交易输入**的时候执行，确保用户对输入有所有权，有权销毁输入的 Cells 。

通过 Cell 模型可以发行用户定义资产（User Defined Asset），可以这样来构造：

1. 设计资产定义合约（Asset Definition），规定资产的主要约束（例如总数量，发行者，交易前后数量不变等）。
2. 保存合约代码到 Asset Definition Cell 中。
3. 在满足发行权限的情况下，发行者发行资产，并将资产状态保存在另外的 State Cell 中。State Cell 的 Type 字段引用保存了资产定义的 Code Cell，保证 State Cell 的变化受到资产定义的约束。
4. Asset Cell 的持有者可以通过更新 Lock 来改变 Asset Cell 的所有者。

Nervos CKB 的 Cell Model 使得手续费收取模型非常灵活，应用层开发者可以利用这种灵活性为终端用户带来更多的方便。

### First-class Asset

在Account模型中，账户是First-class citizen，聚合在账户余额中的硬币没有独立的标识符。**账户是用户直接操作的对象，资产的转移是由账户作为用户的代理实现的，这一点在接受方是合约账户时体现的最为明显**。在这样的模型下，用户定义加密资产（例如ERC20）更像是通过第三方记账的方式，而非点对点的方式转移，这个差异会将第三方（这里的第三方指的是托管加密资产的智能合约）引入资产转移流程，增加智能合约的设计复杂度（我们可以把智能合约看作在资产转移时会自动执行的逻辑）。为了降低这种复杂度，Account模型中的交易需要加入特殊的逻辑（value字段），但是这样的特殊逻辑只有助于原生资产，同时造成对原生资产和用户自定义资产的不同代码路径。

CKB中的用户定义资产（User Defined Asset）可以这样来构造：

1. 设计资产定义合约（Asset Definition），规定资产的主要约束（例如总数量，发行者，交易前后数量不变等）。
2. 保存合约代码到Asset Definition Cell中。
3. 在满足发行权限的情况下，发行者发行资产，并将资产状态保存在另外的State Cell中。State Cell的Type字段引用保存了资产定义的Code Cell，保证State Cell的变化受到资产定义的约束。
4. Asset Cell的持有者可以通过更新Lock来改变Asset Cell的所有者。

## 密码学原语

**目前许多的公链，都将很多密码学原语的使用场景写入了共识层。** 因此在这些公链中，像公私钥签名、客户端验证，以及区块生成的哈希和常用的加密算法，基本上都是镶嵌在共识层中的。例如地址所使用的验证、交易使用的签名等，其实都写在底层协议中，因此会变得非常难以改动。

**如果要更动，唯一的办法就是硬分叉！**

**在 CKB 上除了最基础的交易排序以外，其余都是应用层的内容。**

![Comarasion_flexiblity](https://talk.nervos.org/uploads/default/optimized/2X/5/58630d09aa8b48d8ec329af9b4af60f8faf3d4d7_2_690x404.png)

**任何的开发者未来如果想在 CKB 上 ，为他的资产添加更先进的加密算法做为解锁的规则，是完全可行的**，因为任何人都可以部署各种密码学原语库在 CKB 上，并且可以通过优化去节省存储空间以及减少验证所需的 cycle 去降低部署的成本，让任何先进的密码学原语不用等到硬分叉也能够被使用。

## 经济模型

Bitcoin 在被矿工挖完后，对于矿工的激励将只剩下交易费，那么矿工对于维护网络的安全性是否有着一定的责任感呢，这是否是一个可持续的激励模式呢？

对于完全开放无须许可的区块链网络，抗审查的能力主要来自于最广泛的全球共识，并且让全节点参与的门槛足够的低。但是 Ethereum 有着不可避免的状态爆炸问题，同时由于公地悲剧的存在，造成了现在的窘境。解决方案无非两种，一为状态租赁，另一个为历史裁剪。

但是状态租赁也有问题，一些智能合约如果在暂停一段时间厚希望找回，又该如何操作？

而历史裁剪又需要依托全节点的验证，但是由于状态爆炸的存在，在未来能负担得起全节点的维护的组织只有少数几家，这就又引发了中心化的讨论。

- 必须限制全局状态的增长，以便为参与全节点提供可预测性。理想情况下，成本能控制在非专业参与者可以负担的范围内，以保持网络最大程度的去中心化与抗审查。
- 随着全局状态的有限增长，价格的上升与降低将由市场决定。特别是当状态存储空间快满的时后，需要将状态存储的成本提高，而当它大部分为空时，需要降低成本，这是非常吸引人的。
- 系统需要能够不断收取其状态用户的租金，以支付矿工提供这种资源。这有助于平衡矿工的经济收入，同时激励用户尽早清除不必要的状态。

采用 基础发行+二级发行 的方案。

由于原生代币代表了占用全局状态的权利，所以代币发行政策会限制状态的增长。由于状态存储受限制并且成为了稀缺资源，就好比比特币的带宽和以太坊的计算吞吐量，它们可以在市场上被定价和交易。状态租金在状态占用的费用结构上，增加了必要的时间维度。我们采用两个步骤作为「目标通胀」框架来收取这笔租金，而不是强制定期收取租金：

- 在「基础发行」的基础上，我们添加了「二级发行」，可以将其视为对所有代币持有者的「通胀税」。对于使用CK Byte 存储状态的用户，这种定期的通胀税是他们向矿工支付状态租金的方式。
- 然而，由于我们对于那些没有使用 CK Byte 存储状态的所有者也收取了租金，所以我们需要将租金归还。我们允许这些用户将他们的原生代币存入并锁定到一个特殊合约中，我们称它为 NervosDAO。 NervosDAO 将接受部分「二级发行」的补偿，以弥补因为不公平造成的稀释。

Nervos CKB 是一种「链下计算，链上验证」的平台，因此提交交易的客户端知道计算循环数。在出块时，矿工根据交易费用和交易验证所需的计算循环来排序每笔交易，以在有限的计算和带宽吞吐量下，最大化每一个计算循环数的收入。

在传统的智能合约平台中，网络参与者有着不同的意图 - **用户希望更加低廉的交易手续费，开发者希望自己的应用可以得到广泛使用，矿工们希望获取更高额的收入，持有者希望持有的代币可以增值**。每一类参与者的利益并不是完全一致的，甚至，各自的利益诉求可能发生冲突 - 例如，广泛的应用使用不可能让交易变得低廉（相反，随着区块链的使用需求增加，交易应该更加昂贵）；更加低廉的交易也不会给矿工增加收入；高涨的代币价格对于交易的成本也没有任何帮助（倘若用户不调整其本地交易费用的设置，则可能发生相反的情况）。**去中心化计算平台通过处理交易提供价值，基于这类平台的代币价格并不会实质性地改变整个网络的内在价值。**

在 Nervos CKB 中，**存储资产的用户希望其资产安全；开发者希望(其产品)得到更多地使用，并与之相应，保存更多的资产价值；矿工们希望获得更高的收入，而代币持有者希望他们的代币价格升值**。更高的代币价格支撑着每个人的利益 - 网络变得更加安全，矿工得到更高额的收入，代币持有者得到更丰厚的回报。梳理齐整所有参与者的激励，将使得全网可以最好地利用网络效应来增强其内在价值。此外，这也会培养出一个更具凝聚力的社区，使得整个Nervos系统面临更少的治理挑战。

## Force Bridge

[Force Bridge](https://github.com/nervosnetwork/force-bridge-eth/blob/6eaa18f8f2fe120cbfb2c6f6c008a4d3fe0996bd/docs/introduction.md#features) 是一个可以同时让 Nervos CKB 和多条公链、联盟链进行互操作的跨链解决方案。

众所周知，跨链协议需要解决两个重要的问题：

1. 跨链消息的可信度，即跨链消息的真实性可以被验证
2. 跨链消息的互通性，即消息可以被另一端解码理解

针对这两个问题，Force Bridge 采取的是 SPV 简单支付验证（ [SPV ， Simplified Payment Verification](https://en.bitcoinwiki.org/wiki/Simplified_Payment_Verification_) ）的方式，也就是说在两条要进行跨链的链上，都分别有以智能合约实现的只维护该链区块头（block header）的轻节点，去验证某笔带有另一条链交易的 merkle proof 以及交易信息等数据的交易。例如如果我们要以太坊验证 CKB 的交易，只要在以太坊的链上有 CKB 链上用来做序列化的 [molecule](https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0008-serialization/0008-serialization.md) ，以及用来进行加密的 [blake2b](https://www.blake2.net/) 签名算法库， CKB 的轻节点就能在 ETH 上建构。

![image-10](https://talk.nervos.org/uploads/default/optimized/2X/a/a67e76b4d389a59b69b4f7e6184e81c8a165b5aa_2_690x361.png)

最后，和大家稍微整理一下 Force bridge 的特征和优点：

1. **安全**：首先是足够的安全，因为任何交易的有效性基本上是透过两条链的轻节点以及它的 merkle proof 去进行验证，因此安全是两条链的矿工（或者节点）所赋予的。

2. **具有高度的可延展性**：有赖于 Force Bridge 足够简单的架构，以及 CKB 编程模型的灵活性，我们可以看到 Force Bridge 有很大的延展性：
- 支持任何 ETH 和 ERC 20 资产，甚至在未来的版本还支持包含 ERC 721 等等在 CKB 链上可被 ETH 轻节点验证的资产。
  
- 对于 ForceBridge 而言，将资产跨链给到 CKB 上的合约或者个人，意思是一样的，例如Alice 从 ETH 上把资产给到在 CKB 链上的 Bob ，和给到 CKB 链上的 DEX ，其实要做的事情都是一模一样的。
  
3. 使用**体验滑顺**，有赖于 pw core ， 一个以太坊钱包可以完成 ForceBridge 上两条链的交易和资产操作。